# Diet Agent - Bot de Telegram para An√°lisis Nutricional ü•ó‚ú®

Un bot de Telegram inteligente que analiza fotos de comida, identifica alimentos, calcula calor√≠as y te ayuda a mantener un seguimiento completo de tu dieta diaria.

## üåü Caracter√≠sticas Principales

### üì∏ **An√°lisis Inteligente de Im√°genes**
- Identifica alimentos en fotos usando OpenAI Vision API
- Reconoce ingredientes individuales y platos complejos
- An√°lisis preciso de porciones y cantidades

### üî• **Sistema Completo de Calor√≠as**
- C√°lculo autom√°tico de calor√≠as por alimento
- Desglose detallado de macronutrientes (prote√≠nas, carbohidratos, grasas)
- Base de datos nutricional extensa con alimentos locales

### üéØ **Gesti√≥n de Objetivos Diarios**
- Establecimiento de metas cal√≥ricas personalizadas
- Alertas autom√°ticas cuando superas tu objetivo
- Seguimiento en tiempo real del progreso diario

### üìä **Seguimiento y Estad√≠sticas**
- Historial completo de todas las comidas
- Estad√≠sticas diarias del consumo cal√≥rico
- Reportes mensuales autom√°ticos con tendencias
- Base de datos SQLite local para privacidad

### üîê **Sistema de Autorizaci√≥n**
- Acceso controlado por IDs de usuario autorizados
- Protecci√≥n de datos y uso responsable
- Configuraci√≥n de usuarios m√∫ltiples

### üßπ **Gesti√≥n Autom√°tica de Datos**
- Limpieza autom√°tica de registros antiguos (mantiene √∫ltimos 2 meses)
- Optimizaci√≥n autom√°tica de la base de datos
- Exportaci√≥n de datos antes de purgar

### ‚òÅÔ∏è **Deploy en la Nube**
- Configurado para Railway con webhook
- Deploy autom√°tico desde GitHub
- Escalabilidad y disponibilidad 24/7

## üöÄ Instalaci√≥n

### Prerequisitos

- Python 3.8 o superior
- Cuenta de OpenAI con acceso a Vision API
- Bot de Telegram creado con BotFather

### 1. Clonar el repositorio

```bash
git clone <tu-repositorio>
cd dietAgent
```

### 2. Instalar dependencias

```bash
pip install -r requirements.txt
```

### 3. Configurar variables de entorno

Crea un archivo `.env` en la ra√≠z del proyecto:

```env
# Token del bot de Telegram (obtenido de @BotFather)
TELEGRAM_BOT_TOKEN=tu_token_de_telegram

# API Key de OpenAI
OPENAI_API_KEY=tu_api_key_de_openai
```

### 4. Configurar usuarios autorizados

Agrega los IDs de los usuarios autorizados a usar el bot:

```env
# IDs de usuarios autorizados (separados por comas)
ALLOWED_USER_IDS=123456789,987654321
```

Para obtener tu ID de usuario, puedes usar [@userinfobot](https://t.me/userinfobot)

### 5. Ejecutar el bot

Para desarrollo local:
```bash
python main.py
```

Para producci√≥n con webhook:
```bash
python app_webhook.py
```

## üîß Configuraci√≥n

### Crear bot de Telegram

1. Habla con [@BotFather](https://t.me/BotFather) en Telegram
2. Env√≠a `/newbot` y sigue las instrucciones
3. Guarda el token que te proporcione
4. Agrega el token a tu archivo `.env`

### Obtener API Key de OpenAI

1. Ve a [OpenAI Platform](https://platform.openai.com/)
2. Crea una cuenta o inicia sesi√≥n
3. Ve a API Keys y genera una nueva clave
4. Agrega la clave a tu archivo `.env`

## üì± Uso

1. **Iniciar conversaci√≥n**: Env√≠a `/start` al bot
2. **Enviar foto**: Toma una foto de tu comida y env√≠ala
3. **Recibir an√°lisis**: El bot te responder√° con:
   - Alimentos identificados
   - Calor√≠as estimadas
   - Desglose nutricional
   - Consejos personalizados

### Comandos disponibles

#### üöÄ **Comandos B√°sicos**
- `/start` - Iniciar el bot y configuraci√≥n inicial
- `/help` - Mostrar todos los comandos disponibles

#### üìä **Seguimiento y Estad√≠sticas**
- `/stats` - Ver resumen del consumo diario actual
- `/history` - Ver historial de comidas del d√≠a
- `/monthly_report` - Generar reporte mensual completo

#### üéØ **Gesti√≥n de Objetivos**
- `/set_goal <calor√≠as>` - Establecer objetivo cal√≥rico diario (ej: `/set_goal 2000`)
- `/get_goal` - Ver tu objetivo cal√≥rico actual
- `/clear_goal` - Eliminar objetivo actual

#### üîß **Administraci√≥n**
- `/database_stats` - Ver estad√≠sticas de la base de datos
- `/clear_today` - Limpiar registros del d√≠a actual

### üçΩÔ∏è **Uso Principal**

1. **An√°lisis de Comidas**: 
   - Env√≠a una foto de tu comida
   - El bot analizar√° autom√°ticamente los alimentos
   - Recibir√°s calor√≠as, macronutrientes y consejos

2. **Seguimiento Diario**:
   - Todas las comidas se guardan autom√°ticamente
   - Usa `/stats` para ver tu progreso del d√≠a
   - Recibe alertas si superas tu objetivo

3. **Reportes Mensuales**:
   - Usa `/monthly_report` para ver tendencias
   - Incluye promedios, d√≠as m√°s altos/bajos
   - An√°lisis completo de patrones alimentarios

## üõ†Ô∏è Estructura del proyecto

```
dietAgent/
‚îú‚îÄ‚îÄ app_webhook.py          # Aplicaci√≥n principal con webhook (producci√≥n)
‚îú‚îÄ‚îÄ main.py                 # Bot para desarrollo local
‚îú‚îÄ‚îÄ food_analyzer.py        # Analizador de im√°genes con OpenAI Vision API
‚îú‚îÄ‚îÄ calorie_calculator.py   # Base de datos nutricional y c√°lculos
‚îú‚îÄ‚îÄ diet_database.py        # Gesti√≥n completa de base de datos SQLite
‚îú‚îÄ‚îÄ requirements.txt        # Dependencias del proyecto
‚îú‚îÄ‚îÄ runtime.txt            # Versi√≥n de Python para Railway
‚îú‚îÄ‚îÄ Procfile               # Configuraci√≥n de proceso para Railway
‚îú‚îÄ‚îÄ start.sh               # Script de inicio para producci√≥n
‚îú‚îÄ‚îÄ DEPLOY_GUIDE.md        # Gu√≠a completa de deployment
‚îú‚îÄ‚îÄ .env                   # Variables de entorno (no incluir en git)
‚îú‚îÄ‚îÄ .env.example          # Ejemplo de variables de entorno
‚îî‚îÄ‚îÄ README.md             # Este archivo
```

## üóÉÔ∏è **Base de Datos**

El bot utiliza SQLite para almacenar:

### üìù **Tabla: meals**
- Registro completo de todas las comidas analizadas
- Timestamp, usuario, alimentos identificados, calor√≠as totales
- Desglose de macronutrientes por comida

### ‚öôÔ∏è **Tabla: user_settings**
- Objetivos cal√≥ricos personalizados por usuario
- Configuraciones individuales y preferencias

### üßπ **Gesti√≥n Autom√°tica**
- Purga autom√°tica de registros mayores a 2 meses
- Optimizaci√≥n peri√≥dica de la base de datos
- Estad√≠sticas de uso y rendimiento

## üß† C√≥mo funciona

### üîÑ **Flujo de An√°lisis de Comidas**

1. **üì∏ Recepci√≥n de imagen**: El usuario env√≠a una foto de su comida
2. **üîê Verificaci√≥n de autorizaci√≥n**: El sistema valida que el usuario tenga permisos
3. **ü§ñ An√°lisis con IA**: OpenAI Vision API identifica alimentos, ingredientes y porciones
4. **üìä C√°lculo nutricional**: Base de datos local calcula calor√≠as y macronutrientes precisos
5. **üíæ Almacenamiento**: Se guarda el registro completo en la base de datos SQLite
6. **üéØ Verificaci√≥n de objetivos**: Se compara con la meta diaria del usuario
7. **‚ö†Ô∏è Alertas inteligentes**: Si supera el objetivo, se env√≠a una advertencia autom√°tica
8. **üì± Respuesta completa**: Se formatea y env√≠a el an√°lisis detallado

### üìà **Sistema de Seguimiento**

1. **Acumulaci√≥n diaria**: Todas las comidas se suman para el total del d√≠a
2. **C√°lculo de progresos**: Comparaci√≥n continua con objetivos establecidos
3. **Generaci√≥n de estad√≠sticas**: Promedios, tendencias y patrones alimentarios
4. **Reportes autom√°ticos**: An√°lisis mensuales con insights personalizados

### üîß **Gesti√≥n de Datos**

1. **Almacenamiento local**: Todos los datos se mantienen en SQLite local
2. **Purga autom√°tica**: Sistema elimina registros antiguos (>2 meses)
3. **Optimizaci√≥n continua**: La base de datos se optimiza autom√°ticamente
4. **Backup inteligente**: Los datos se exportan antes de cualquier purga

## üìä Base de datos nutricional

### ü•ò **Alimentos Incluidos**

**Prote√≠nas (por 100g)**
- Pollo, carne de res, cerdo, pescados variados
- Huevos, l√°cteos (queso, yogur, leche)
- Legumbres (frijoles, lentejas, garbanzos)
- Frutos secos y semillas

**Carbohidratos (por 100g)**
- Cereales (arroz, avena, quinoa)
- Pastas y panes variados
- Tub√©rculos (papa, camote, yuca)
- Frutas frescas y secas

**Verduras y Vegetales (por 100g)**
- Vegetales de hoja verde
- Verduras cruc√≠feras (br√≥coli, coliflor)
- Verduras de colores variados
- Hongos y setas

**Grasas Saludables**
- Aceites vegetales (oliva, aguacate)
- Frutos secos y semillas
- Aguacate y aceitunas

**Bebidas y Otros**
- Bebidas alcoh√≥licas y no alcoh√≥licas
- Salsas y condimentos
- Dulces y postres
- Snacks y alimentos procesados

### üìà **Precisi√≥n Nutricional**

- **+150 alimentos** en la base de datos
- Valores nutricionales por 100g est√°ndar
- C√°lculos autom√°ticos basados en porciones estimadas por IA
- Macronutrientes detallados (prote√≠nas, carbohidratos, grasas)
- Actualizaci√≥n continua con nuevos alimentos

## ‚òÅÔ∏è Deployment en Railway

### ÔøΩ **Deploy Autom√°tico**

El proyecto est√° configurado para deployment autom√°tico en Railway:

1. **Configuraci√≥n autom√°tica**: `Procfile` y `runtime.txt` incluidos
2. **Variables de entorno**: Se configuran directamente en Railway
3. **Webhook URL**: Railway proporciona URL autom√°tica para webhook
4. **Deploy desde GitHub**: Cada push activa un nuevo deployment
5. **Logs en tiempo real**: Monitoreo completo desde Railway dashboard

### üìã **Variables de Entorno Requeridas**

```env
TELEGRAM_BOT_TOKEN=tu_token_del_bot
OPENAI_API_KEY=tu_api_key_openai
ALLOWED_USER_IDS=id1,id2,id3
WEBHOOK_URL=https://tu-app.railway.app
```

Ver `DEPLOY_GUIDE.md` para instrucciones completas de deployment.

## üÜï Funcionalidades Implementadas

### ‚úÖ **Completado**
- [x] Seguimiento completo de calor√≠as diarias
- [x] Base de datos SQLite con gesti√≥n completa
- [x] Objetivos nutricionales personalizados con alertas
- [x] Sistema de autorizaci√≥n por usuario
- [x] Reportes mensuales autom√°ticos
- [x] Purga autom√°tica de datos antiguos
- [x] Deploy en Railway con webhook
- [x] An√°lisis avanzado con OpenAI Vision
- [x] Historial completo de comidas
- [x] Estad√≠sticas diarias y mensuales

### üîÆ **Funcionalidades Futuras**

- [ ] Exportar datos a CSV/Excel
- [ ] Integraci√≥n con apps de fitness (Apple Health, Google Fit)
- [ ] An√°lisis de restaurantes y cadenas espec√≠ficas
- [ ] Reconocimiento de c√≥digos de barras
- [ ] Planificaci√≥n de comidas semanales
- [ ] An√°lisis de tendencias nutricionales
- [ ] Integraci√≥n con bases de datos nutricionales externas
- [ ] Sistema de recordatorios de comidas
- [ ] An√°lisis de patrones alimentarios con IA
- [ ] Recomendaciones personalizadas de mejora

## üêõ Soluci√≥n de problemas

### ü§ñ **El bot no responde**
- Verifica que `TELEGRAM_BOT_TOKEN` est√© correctamente configurado
- Aseg√∫rate de que tu ID est√© en `ALLOWED_USER_IDS`
- Revisa que el bot est√© ejecut√°ndose sin errores
- En Railway, verifica los logs del deployment

### üîë **Error de autorizaci√≥n**
- Usa [@userinfobot](https://t.me/userinfobot) para obtener tu ID de usuario
- Agrega tu ID a la variable `ALLOWED_USER_IDS`
- Reinicia el bot despu√©s de cambiar usuarios autorizados

### üì∏ **Error de an√°lisis de imagen**
- Verifica tu `OPENAI_API_KEY`
- Aseg√∫rate de tener cr√©ditos suficientes en OpenAI
- Intenta con una foto m√°s clara y bien iluminada
- Verifica que la imagen no est√© corrupta

### üçΩÔ∏è **Alimentos no identificados**
- La IA puede no reconocer algunos alimentos poco comunes
- Intenta con una foto m√°s clara que muestre bien los alimentos
- Puedes expandir la base de datos en `calorie_calculator.py`
- Reporta alimentos faltantes para futuras actualizaciones

### üíæ **Problemas de base de datos**
- Usa `/database_stats` para verificar el estado
- Los datos se purgan autom√°ticamente cada 2 meses
- Si hay errores persistentes, reinicia la aplicaci√≥n
- Los registros se respaldan antes de cualquier purga

### ‚òÅÔ∏è **Problemas de deployment**
- Verifica todas las variables de entorno en Railway
- Aseg√∫rate de que `WEBHOOK_URL` est√© correctamente configurado
- Revisa los logs de Railway para errores espec√≠ficos
- El webhook debe ser HTTPS y accesible p√∫blicamente

### üìä **Comandos no funcionan**
- Verifica que est√©s usando la sintaxis correcta
- Algunos comandos requieren par√°metros (ej: `/set_goal 2000`)
- Aseg√∫rate de estar autorizado para usar el bot
- Reinicia la conversaci√≥n con `/start` si hay problemas

## ü§ù Contribuir

1. Fork el proyecto
2. Crea una branch para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit tus cambios (`git commit -am 'Agregar nueva funcionalidad'`)
4. Push a la branch (`git push origin feature/nueva-funcionalidad`)
5. Abre un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

## üìà **Estad√≠sticas del Sistema**

### üìä **M√©tricas Disponibles**
- Total de comidas analizadas
- Usuarios activos registrados  
- Promedio de calor√≠as por comida
- Tendencias mensuales completas
- Eficiencia del sistema de purga

### üîç **Monitoreo**
- Usa `/database_stats` para ver estad√≠sticas en tiempo real
- Logs detallados en Railway para debugging
- Sistema de alertas autom√°ticas para objetivos
- Reportes mensuales con insights personalizados

## ‚ö†Ô∏è **Privacidad y Disclaimer**

### üîê **Privacidad**
- Todos los datos se almacenan localmente en SQLite
- No se comparten datos con terceros
- Sistema de autorizaci√≥n controla el acceso
- Purga autom√°tica de datos antiguos (>2 meses)

### üìã **Disclaimer M√©dico**
Este bot proporciona **estimaciones nutricionales para fines informativos √∫nicamente**. 

- No reemplaza el consejo m√©dico profesional
- Las calor√≠as son aproximaciones basadas en an√°lisis de IA
- Consulta con un nutricionista para necesidades diet√©ticas espec√≠ficas
- No debe usarse como √∫nica fuente para dietas restrictivas
- Los c√°lculos pueden variar seg√∫n preparaci√≥n y porciones reales

## ü§ù **Contribuir**

### ÔøΩ **Desarrollo**
1. Fork el proyecto desde GitHub
2. Crea una branch para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. Desarrolla y prueba tus cambios localmente
4. Commit tus cambios (`git commit -am 'Agregar nueva funcionalidad'`)
5. Push a la branch (`git push origin feature/nueva-funcionalidad`)
6. Abre un Pull Request con descripci√≥n detallada

### üí° **Ideas y Sugerencias**
- Abre issues en GitHub para nuevas funcionalidades
- Reporta bugs con informaci√≥n detallada
- Sugiere mejoras en la base de datos nutricional
- Comparte casos de uso interesantes

## üìû **Soporte y Contacto**

### üÜò **Ayuda T√©cnica**
- üìù **Issues de GitHub**: Para bugs y problemas t√©cnicos
- üìñ **Documentaci√≥n**: Ver `DEPLOY_GUIDE.md` para deployment
- üí¨ **Discusiones**: Para ideas y mejoras generales

### üìß **Contacto Directo**
- Desarrollador principal: [@tu_usuario_telegram]
- Email: tu_email@ejemplo.com
- GitHub: [@tu_usuario_github]

---

## üéâ **¬°Disfruta del Diet Agent!**

### üåü **Empieza Ahora**
1. ü§ñ Inicia conversaci√≥n con `/start`
2. üì∏ Env√≠a una foto de tu comida
3. üéØ Establece tu objetivo con `/set_goal`
4. üìä Revisa tu progreso con `/stats`
5. üìà Genera reportes con `/monthly_report`

### üí™ **Alimentaci√≥n Consciente**
Con Diet Agent, mantener un registro nutricional nunca fue tan f√°cil. 
¬°Toma fotos, recibe an√°lisis instant√°neos y alcanza tus objetivos de salud!

**ü•ó‚ú® ¬°Una vida m√°s saludable est√° a una foto de distancia! ‚ú®ü•ó**

---

*√öltima actualizaci√≥n: Septiembre 2025 - Versi√≥n 2.0 con seguimiento completo y deployment autom√°tico*
